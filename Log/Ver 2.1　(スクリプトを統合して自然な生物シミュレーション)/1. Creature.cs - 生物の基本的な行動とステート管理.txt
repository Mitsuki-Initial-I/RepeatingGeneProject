using UnityEngine;

public class Creature : MonoBehaviour
{
    public float speed = 5f;
    public float energy = 100f;
    public float lifespan = 100f;
    public float hunger = 100f;
    public float sleepiness = 0f;
    public float matingDesire = 50f;
    public float socialRank = 1f;  // 社会的序列

    private float age = 0f;
    private float actionTimer = 0f;
    public State currentState = State.Moving;
    private Environment environment;

    public enum State { Idle, Moving, SeekingFood, Eating, SeekingSleep, Sleeping, Mating, Dead }

    void Start()
    {
        environment = FindObjectOfType<Environment>();  // 環境を参照
    }

    void Update()
    {
        if (currentState != State.Dead)
        {
            age += Time.deltaTime;
            if (age >= lifespan)
            {
                Die();
                return;
            }
            HandleState();
        }
    }

    void HandleState()
    {
        switch (currentState)
        {
            case State.Moving:
                Move();
                if (hunger <= 20) currentState = State.SeekingFood;
                else if (sleepiness >= 80) currentState = State.SeekingSleep;
                else if (matingDesire >= 80) currentState = State.Mating;
                break;
            case State.SeekingFood: SeekFood(); break;
            case State.Eating: Eat(); break;
            case State.SeekingSleep: SeekSleep(); break;
            case State.Sleeping: Sleep(); break;
            case State.Mating: Mate(); break;
        }
    }

    void Move()
    {
        transform.Translate(Vector3.forward * speed * Time.deltaTime);
        Debug.Log("Moving...");
    }

    void SeekFood()
    {
        Debug.Log("Seeking food...");
        if (environment.GetResourceAvailability() > 0.5f)  // 環境からの資源量で判断
        {
            currentState = State.Eating;
        }
    }

    void Eat()
    {
        Debug.Log("Eating...");
        hunger += 50f;
        if (hunger > 100f) hunger = 100f;
        currentState = State.Moving;
    }

    void SeekSleep()
    {
        Debug.Log("Seeking sleep...");
        currentState = State.Sleeping;
    }

    void Sleep()
    {
        Debug.Log("Sleeping...");
        sleepiness = 0f;
        energy = 100f;
        currentState = State.Moving;
    }

    void Mate()
    {
        Debug.Log("Mating...");
        matingDesire = 0f;
        currentState = State.Moving;
    }

    void Die()
    {
        currentState = State.Dead;
        Debug.Log("Creature has died.");
    }
}
